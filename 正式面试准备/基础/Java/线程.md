## å®ç°çº¿ç¨‹çš„ä¸‰ç§æ–¹å¼

åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼
- ç»§æ‰¿Threadç±»
- å®ç°Runnableæ¥å£åˆ›å»ºçº¿ç¨‹
- ä½¿ç”¨Callableå’ŒFutureåˆ›å»ºçº¿ç¨‹


### ç»§æ‰¿Threadç±»

çœ‹jdkæºç å¯ä»¥å‘ç°ï¼ŒThreadç±»å…¶å®æ˜¯å®ç°äº†Runnableæ¥å£çš„ä¸€ä¸ªå®ä¾‹ï¼Œç»§æ‰¿Threadç±»åéœ€è¦é‡å†™runæ–¹æ³•å¹¶é€šè¿‡startæ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚ç»§æ‰¿Threadç±»è€¦åˆæ€§å¤ªå¼ºäº†ï¼Œå› ä¸ºjavaåªèƒ½å•ç»§æ‰¿ï¼Œæ‰€ä»¥ä¸åˆ©äºæ‰©å±•ã€‚

```java
  class Thread1 extends Thread {
        @Override
        public void run() {
            System.out.println("Thread1 is Running...");
        }
    }
```

### å®ç°Runnableæ¥å£

é€šè¿‡å®ç°Runnableæ¥å£å¹¶é‡å†™runæ–¹æ³•ï¼Œå¹¶æŠŠRunnableå®ä¾‹ä¼ ç»™Threadå¯¹è±¡ï¼ŒThreadçš„startæ–¹æ³•è°ƒç”¨runæ–¹æ³•å†é€šè¿‡è°ƒç”¨Runnableå®ä¾‹çš„runæ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚æ‰€ä»¥å¦‚æœä¸€ä¸ªç±»ç»§æ‰¿äº†å¦å¤–ä¸€ä¸ªçˆ¶ç±»ï¼Œæ­¤æ—¶è¦å®ç°å¤šçº¿ç¨‹å°±ä¸èƒ½é€šè¿‡ç»§æ‰¿Threadçš„ç±»å®ç°ã€‚
```java
 class Thread2 implements Runnable {
        @Override
        public void run() {
            System.out.println("Thread2 is Running...");
        }
    }
```

### å®ç°Callableæ¥å£

é€šè¿‡å®ç°Callableæ¥å£å¹¶é‡å†™callæ–¹æ³•ï¼Œå¹¶æŠŠCallableå®ä¾‹ä¼ ç»™FutureTaskå¯¹è±¡ï¼Œå†æŠŠFutureTaskå¯¹è±¡ä¼ ç»™Threadå¯¹è±¡ã€‚å®ƒä¸Threadã€Runnableæœ€å¤§çš„ä¸åŒæ˜¯Callableèƒ½è¿”å›ä¸€ä¸ªå¼‚æ­¥å¤„ç†çš„ç»“æœFutureå¯¹è±¡å¹¶èƒ½æŠ›å‡ºå¼‚å¸¸ï¼Œè€Œå…¶ä»–ä¸¤ç§ä¸èƒ½ã€‚

```java
 class Thread3<T> implements Callable<T> {
        @SuppressWarnings("unchecked")
        @Override
        public T call() throws Exception {
            System.out.println("Thread3 is Running...");
            return (T) new User("jiao", 23);
        }
    }

```

ç”±äºä¸Šè¿°ä¸¤ç§åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼æ— æ³•ä¿è¯è·å–ä¹‹å‰çš„è€Œæ‰§è¡Œç»“æœï¼Œé€šè¿‡å®ç°Callbackæ¥å£ï¼Œå¹¶ç”¨Futureå¯ä»¥æ¥æ”¶å¤šçº¿ç¨‹çš„æ‰§è¡Œç»“æœã€‚

Futureç±»å­˜åœ¨äºJDKçš„concurrentåŒ…ä¸­ï¼Œä¸»è¦ç”¨é€”æ˜¯æ¥å—Javaçš„å¼‚æ­¥çº¿ç¨‹è®¡ç®—è¿”å›ç»“æœã€‚

ä¸¾ä¸ªä¾‹å­ï¼šæ¯”å¦‚å»åƒæ—©ç‚¹æ—¶ï¼Œç‚¹äº†åŒ…å­å’Œå‡‰èœï¼ŒåŒ…å­éœ€è¦ç­‰3åˆ†é’Ÿï¼Œå‡‰èœåªéœ€1åˆ†é’Ÿï¼Œå¦‚æœæ˜¯ä¸²è¡Œçš„ä¸€ä¸ªæ‰§è¡Œï¼Œåœ¨åƒä¸Šæ—©ç‚¹çš„æ—¶å€™éœ€è¦ç­‰å¾…4åˆ†é’Ÿï¼Œä½†æ˜¯å› ä¸ºä½ åœ¨ç­‰åŒ…å­çš„æ—¶å€™ï¼Œå¯ä»¥åŒæ—¶å‡†å¤‡å‡‰èœï¼Œæ‰€ä»¥åœ¨å‡†å¤‡å‡‰èœçš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥åŒæ—¶å‡†å¤‡åŒ…å­ï¼Œè¿™æ ·åªéœ€è¦ç­‰å¾…3åˆ†é’Ÿã€‚é‚£Futureè¿™ç§æ¨¡å¼å°±æ˜¯åé¢è¿™ç§æ‰§è¡Œæ¨¡å¼ã€‚

[ğŸ” | Futureå¯¹è±¡](https://www.cnblogs.com/jcjssl/p/9592145.html)

## å…³é—­çº¿ç¨‹çš„ä¸‰ç§æ–¹å¼
ä½¿ç”¨runæ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œè¯¥çº¿ç¨‹å°±ç»ˆæ­¢äº†ã€‚ä½†æ˜¯åœ¨æŸäº›ç‰¹æ®Šæƒ…å½¢ä¸‹ï¼Œrun()æ–¹æ³•ä¼šè¢«ä¸€ç›´æ‰§è¡Œï¼Œæ¯”å¦‚ä½¿ç”¨**while(true){...}**è¿™æ ·çš„å¾ªç¯è¯­å¥ã€‚

- ä½¿ç”¨æ ‡å¿—ä½ç»ˆæ­¢çº¿ç¨‹
- ä½¿ç”¨stop()ç»ˆæ­¢çº¿ç¨‹ï¼ˆè¿‡æ—¶ï¼‰
- ä½¿ç”¨interrupt()ä¸­æ–­çº¿ç¨‹

### ä½¿ç”¨æ ‡å¿—ä½ç»ˆæ­¢çº¿ç¨‹
ä¿®æ”¹æ ‡å¿—ä½çš„æ–¹å¼ç»“æŸrunï¼ˆï¼‰æ–¹æ³•

```java
public class ServerThread extends Thread {
    //volatileä¿®é¥°ç¬¦ç”¨æ¥ä¿è¯å…¶å®ƒçº¿ç¨‹è¯»å–çš„æ€»æ˜¯è¯¥å˜é‡çš„æœ€æ–°çš„å€¼
    public volatile boolean exit = false; 

    @Override
    public void run() {
        ServerSocket serverSocket = new ServerSocket(8080);
        while(!exit){
            serverSocket.accept(); //é˜»å¡ç­‰å¾…å®¢æˆ·ç«¯æ¶ˆæ¯
            ...
        }
    }
    
    public static void main(String[] args) {
        ServerThread t = new ServerThread();
        t.start();
        ...
        t.exit = true; //ä¿®æ”¹æ ‡å¿—ä½ï¼Œé€€å‡ºçº¿ç¨‹
    }
}

```


### ä½¿ç”¨stop()ç»ˆæ­¢çº¿ç¨‹
ä½¿ç”¨stop()æ–¹æ³•ç¡®å®å¯ä»¥ç»ˆæ­¢çº¿ç¨‹ï¼Œä½†æ˜¯java.lang.Threadä¸­é™¤äº†start()æ–¹æ³•å¤–ï¼Œstop(), resume(), suspend(), destory()ç­‰æ–¹æ³•å·²ç»è¿‡æ—¶ï¼ˆdeprecatedï¼‰

ä¸ºä»€ä¹ˆå¼ƒç”¨stopï¼š
 - è°ƒç”¨stopæ–¹æ³•ä¼šç«‹å³åœæ­¢run()æ–¹æ³•ä¸­å‰©ä½™çš„å…¨éƒ¨å·¥ä½œï¼ŒåŒ…æ‹¬catchæˆ–finallyè¯­å¥ä¸­çš„ï¼Œå¹¶æŠ›å‡ºThreadDeathå¼‚å¸¸(é€šå¸¸æƒ…å†µä¸‹æ­¤å¼‚å¸¸ä¸éœ€è¦æ˜¾ç¤ºçš„æ•è·)ï¼Œå› æ­¤å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›æ¸…ç†æ€§çš„å·¥ä½œçš„å¾—ä¸åˆ°å®Œæˆï¼Œå¦‚æ–‡ä»¶ï¼Œæ•°æ®åº“ç­‰çš„å…³é—­ã€‚
 - è°ƒç”¨ stop() æ–¹æ³•ä¼šç«‹å³é‡Šæ”¾è¯¥çº¿ç¨‹æ‰€æŒæœ‰çš„æ‰€æœ‰çš„é”ï¼Œå¯¼è‡´æ•°æ®å¾—ä¸åˆ°åŒæ­¥ï¼Œå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚

### ä½¿ç”¨interrupt()ä¸­æ–­çº¿ç¨‹

ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†ä½¿ç”¨ stop() æ–¹å¼åœæ­¢çº¿ç¨‹æ˜¯éå¸¸ä¸å®‰å…¨çš„æ–¹å¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ä»€ä¹ˆæ–¹æ³•æ¥åœæ­¢çº¿ç¨‹å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ä½¿ç”¨ interrupt() æ–¹æ³•æ¥ä¸­æ–­çº¿ç¨‹ã€‚

è°ƒç”¨ interrupt() æ–¹æ³•ä»…ä»…æ˜¯åœ¨å½“å‰çº¿ç¨‹ä¸­æ‰“ä¸€ä¸ªåœæ­¢çš„æ ‡è®°ï¼Œå¹¶ä¸æ˜¯çœŸçš„åœæ­¢çº¿ç¨‹ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œçº¿ç¨‹ä¸­æ–­å¹¶ä¸ä¼šç«‹å³ç»ˆæ­¢çº¿ç¨‹ï¼Œè€Œæ˜¯é€šçŸ¥ç›®æ ‡çº¿ç¨‹ï¼Œæœ‰äººå¸Œæœ›ä½ ç»ˆæ­¢ã€‚è‡³äºç›®æ ‡çº¿ç¨‹æ”¶åˆ°é€šçŸ¥åä¼šå¦‚ä½•å¤„ç†ï¼Œåˆ™å®Œå…¨ç”±ç›®æ ‡çº¿ç¨‹è‡ªè¡Œå†³å®šã€‚è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå¦‚æœä¸­æ–­åï¼Œçº¿ç¨‹ç«‹å³æ— æ¡ä»¶é€€å‡ºï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆä¼šé‡åˆ° stop() æ–¹æ³•çš„è€é—®é¢˜ã€‚

```java
public class demo5 extends Thread {
    public static void main(String[] args) {
        try {
            demo5 t = new demo5();
            t.start();
            Thread.sleep(200);
            t.interrupt();
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }

    @Override
    public void run() {
        super.run();
        for (int i = 0; i <= 200000; i++) {
            //åˆ¤æ–­æ˜¯å¦è¢«ä¸­æ–­
            if (Thread.currentThread().isInterrupted()) {
                //å¤„ç†ä¸­æ–­é€»è¾‘
                break;
            }
            System.out.println("i=" + i);
        }
    }
}
```

**æ³¨æ„ï¼š** å¦‚æœå¸Œæœ›çº¿ç¨‹tåœ¨ä¸­æ–­ååœæ­¢ï¼Œå°±å¿…é¡»å…ˆåˆ¤æ–­æ˜¯å¦è¢«ä¸­æ–­ï¼Œå¹¶ä¸ºå®ƒå¢åŠ ç›¸åº”çš„ä¸­æ–­å¤„ç†ä»£ç 
```java
if(Thread.currentThread().isInterrupted()){
    //å¤„ç†ä¸­æ–­é€»è¾‘
    break;
}
```

è¿™ç§æ–¹å¼çœ‹èµ·æ¥ä¸ä¹‹å‰ä»‹ç»çš„â€œä½¿ç”¨æ ‡å¿—ä½ç»ˆæ­¢çº¿ç¨‹â€éå¸¸ç±»ä¼¼ï¼Œ**ä½†æ˜¯åœ¨é‡åˆ° sleep() æˆ–è€… wait() è¿™æ ·çš„æ“ä½œï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡ä¸­æ–­æ¥å¤„ç†äº†**ã€‚

`public static native void sleep(long millis) throws InterruptedException`

Thread.sleep() æ–¹æ³•ä¼šæŠ›å‡ºä¸€ä¸ª InterruptedException å¼‚å¸¸ï¼Œå½“çº¿ç¨‹è¢« sleep() ä¼‘çœ æ—¶ï¼Œå¦‚æœè¢«ä¸­æ–­ï¼Œè¿™ä¼šå°±æŠ›å‡ºè¿™ä¸ªå¼‚å¸¸ã€‚

Thread.sleep() æ–¹æ³•ç”±äºä¸­æ–­è€ŒæŠ›å‡ºçš„å¼‚å¸¸ï¼Œæ˜¯ä¼šæ¸…é™¤ä¸­æ–­æ ‡è®°çš„ã€‚

[ğŸ” | Javaç»ˆæ­¢çº¿ç¨‹çš„ä¸‰ç§æ–¹å¼](https://www.cnblogs.com/liyutian/p/10196044.html)

## Thread å’Œ Runnableçš„åŒºåˆ«

1. Runnableæ–¹å¼å¯ä»¥é¿å…Threadæ–¹å¼ç”±äºJavaå•ç»§æ‰¿ç‰¹æ€§å¸¦æ¥çš„ç¼ºé™·
2. Runnableçš„ä»£ç å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹ï¼ˆThreadå®ä¾‹ï¼‰å…±äº«ï¼Œé€‚ç”¨äºå¤šä¸ªçº¿ç¨‹å¤„ç†åŒä¸€èµ„æºçš„æƒ…å†µ

å·®åˆ«çš„æ¡ˆä¾‹è¯·çœ‹ä¸‹é¢ä¸¤ç§æ–¹å¼å®ç°ä¹°ç¥¨åŠŸèƒ½

### Threadæ¨¡æ‹Ÿä¹°ç¥¨
1. ç¼–å†™MyThreadç±»
```java
/**
 * ä½¿ç”¨ Thread åˆ›å»ºçº¿ç¨‹
 *
 */
public class MyThread extends Thread {
    
    /** ä¸€å…±æœ‰5å¼ ç«è½¦ç¥¨ */
    private int ticketsCont = 5;
    /** çª—å£ï¼Œä¹Ÿå³æ˜¯çº¿ç¨‹çš„åå­— */
    private String name;
    
    public MyThread(String name){
        this.name = name;
    }
    
    // å†™ä¹°ç¥¨é€»è¾‘
    @Override
    public void run() {
        while(ticketsCont > 0 ){
            // å¦‚æœè¿˜æœ‰ç¥¨ï¼Œå°±å–æ‰ä¸€å¼ 
            ticketsCont--;
            System.out.println(name + "å–äº†1å¼ ç¥¨ï¼Œå‰©ä½™ç¥¨æ•°ä¸ºï¼š"+ticketsCont);
        }
    }
}
```

2. ç¼–å†™TicketsThreadç±»
```java
/**
 * ä¸»ç±»-å¯åŠ¨çº¿ç¨‹ç±»
 *
 */
public class TicketsThread {
    
    public static void main(String[] args) {
        
        // åˆ›å»ºä¸‰ä¸ªçº¿ç¨‹ï¼Œæ¨¡æ‹Ÿä¸‰ä¸ªçª—å£å–ç¥¨
        MyThread mt1 = new MyThread("çª—å£1");
        MyThread mt2 = new MyThread("çª—å£2");
        MyThread mt3 = new MyThread("çª—å£3");
        
        // å¯åŠ¨è¿™ä¸‰ä¸ªçº¿ç¨‹ï¼Œå³çª—å£å¼€å§‹å–ç¥¨
        mt1.start();
        mt2.start();
        mt3.start();
    }
}
```

è¿è¡Œç»“æœï¼š
![](https://github.com/Dannymeng/picture/blob/master/1470009024-596104fd10243_articlex.png?raw=true)

æ€»å…±æœ‰5å¼ ç¥¨ï¼Œä½†æ˜¯ä¸‰ä¸ªçª—å£åŠ åœ¨ä¸€èµ·å–äº†15å¼ ç¥¨ã€‚é€ æˆæœ‰äº›äººä¹°äº†ç¥¨ï¼Œä¸Šä¸äº†è½¦ï¼Œè¿™ç§æƒ…å†µä¸æ˜¯æˆ‘ä»¬æ„¿æ„çœ‹åˆ°çš„ã€‚å…·ä½“åŸå› ï¼Œå†™å®ŒRunnableåï¼Œä¼šè®²è§£ã€‚

### Runnableæ¨¡æ‹Ÿä¹°ç¥¨

1. ç¼–å†™MyThreadç±»

```java
/**
 * ä½¿ç”¨ Runnable åˆ›å»ºçº¿ç¨‹
 *
 */
public class MyThread implements Runnable {
    
    /** ä¸€å…±æœ‰5å¼ ç«è½¦ç¥¨ */
    private int ticketsCont = 5;
    
    // å†™ä¹°ç¥¨é€»è¾‘
    @Override
    public void run() {
        while(ticketsCont > 0 ){
            // å¦‚æœè¿˜æœ‰ç¥¨ï¼Œå°±å–æ‰ä¸€å¼ 
            ticketsCont--;
            System.out.println(Thread.currentThread().getName() + "å–äº†1å¼ ç¥¨ï¼Œå‰©ä½™ç¥¨æ•°ä¸ºï¼š"+ticketsCont);
        }
    }
}
```

2. ç¼–å†™TicketsRunnableç±»

```java
/**
 * ä¸»ç±»-å¯åŠ¨çº¿ç¨‹ç±»
 *
 */
public class TicketsRunnable {
    
    public static void main(String[] args) {
        
        MyThread mt = new MyThread();
        
        // åˆ›å»ºä¸‰ä¸ªçº¿ç¨‹ï¼Œæ¨¡æ‹Ÿä¸‰ä¸ªçª—å£å–ç¥¨
        Thread th1 = new Thread(mt,"çª—å£1");
        Thread th2 = new Thread(mt,"çª—å£2");
        Thread th3 = new Thread(mt,"çª—å£3");
        
        // å¯åŠ¨è¿™ä¸‰ä¸ªçº¿ç¨‹ï¼Œå³çª—å£å¼€å§‹å–ç¥¨
        th1.start();
        th2.start();
        th3.start();      
    } 
}
```

è¿è¡Œç»“æœï¼š
![](https://github.com/Dannymeng/picture/blob/master/1453287203-59610523ab834_articlex.png?raw=true)

æ­£å› ä¸ºRunnableçš„ä»£ç å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹ï¼ˆThreadå®ä¾‹ï¼‰å…±äº«ï¼Œé€‚ç”¨äºå¤šä¸ªçº¿ç¨‹å¤„ç†åŒä¸€èµ„æº

## çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå’Œå®ˆæŠ¤çº¿ç¨‹

çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ

![](https://github.com/Dannymeng/picture/blob/master/3746061616-59610544add49_articlex.png?raw=true)

åˆ›å»º

```
æ–°å»ºä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ï¼Œå¦‚ThreafÂ thd =Â newÂ Thread()
```

å°±ç»ª

```
åˆ›å»ºäº†çº¿ç¨‹å¯¹è±¡åï¼Œè°ƒç”¨äº†çº¿ç¨‹çš„start()æ–¹æ³•ï¼ˆæ³¨æ„ï¼šæ­¤æ—¶çº¿ç¨‹åªæ˜¯è¿›å…¥äº†çº¿ç¨‹é˜Ÿåˆ—ï¼Œç­‰å¾…è·å–CPUæœåŠ¡ï¼Œå…·å¤‡äº†è¿è¡Œçš„æ¡ä»¶ï¼Œä½†å¹¶ä¸ä¸€å®šå·²ç»å¼€å§‹è¿è¡Œäº†ï¼‰
```

è¿è¡Œ

```
å¤„äºå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹ï¼Œä¸€æ—¦è·å–äº†CPUèµ„æºï¼Œä¾¿è¿›å…¥åˆ°è¿è¡ŒçŠ¶æ€ï¼Œå¼€å§‹æ‰§è¡Œrun()æ–¹æ³•é‡Œé¢çš„é€»è¾‘
```

ç»ˆæ­¢

```
çº¿ç¨‹çš„run()æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œæˆ–è€…çº¿ç¨‹è°ƒç”¨äº†stop()æ–¹æ³•ï¼Œçº¿ç¨‹ä¾¿è¿›å…¥ç»ˆæ­¢çŠ¶æ€
```

é˜»å¡

```
ä¸€ä¸ªæ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç”±äºæŸç§åŸå› è€Œæš‚æ—¶è®©å‡ºäº†CPUèµ„æºï¼Œæš‚åœäº†è‡ªå·±çš„æ‰§è¡Œï¼Œä¾¿è¿›å…¥äº†é˜»å¡çŠ¶æ€ï¼Œå¦‚è°ƒç”¨äº†sleep()æ–¹æ³•
```


